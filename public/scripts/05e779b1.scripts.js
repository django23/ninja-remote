angular.module("ui.config",[]).value("ui.config",{}),angular.module("ui.filters",["ui.config"]),angular.module("ui.directives",["ui.config"]),angular.module("ui",["ui.filters","ui.directives","ui.config"]),angular.module("ui.directives").directive("uiSortable",["ui.config",function(a){var b;return b={},a.sortable!=null&&angular.extend(b,a.sortable),{require:"?ngModel",link:function(a,c,d,e){var f,g,h,i,j;return h=angular.extend({},b,a.$eval(d.uiOptions)),e!=null&&(f=function(a,b){return b.item.data("ui-sortable-start",b.item.index())},g=function(b,c){var d,f;return f=c.item.data("ui-sortable-start"),d=c.item.index(),e.$modelValue.splice(d,0,e.$modelValue.splice(f,1)[0]),a.$apply()},i=h.start,h.start=function(b,c){return f(b,c),typeof i=="function"&&i(b,c),a.$apply()},j=h.update,h.update=function(b,c){return g(b,c),typeof j=="function"&&j(b,c),a.$apply()}),c.sortable(h)}}}]),angular.module("ui.directives").directive("uiJq",["ui.config",function(a){return{restrict:"A",compile:function(b,c){if(!angular.isFunction(b[c.uiJq]))throw new Error('ui-jq: The "'+c.uiJq+'" function does not exist');var d=a.jq&&a.jq[c.uiJq];return function(a,b,c){var e=[],f="change";c.uiOptions?(e=a.$eval("["+c.uiOptions+"]"),angular.isObject(d)&&angular.isObject(e[0])&&(e[0]=angular.extend(d,e[0]))):d&&(e=[d]),c.ngModel&&b.is("select,input,textarea")&&(e&&angular.isObject(e[0])&&e[0].ngChange!==undefined&&(f=e[0].ngChange),f&&b.on(f,function(){b.trigger("input")})),b[c.uiJq].apply(b,e)}}}}]),angular.module("ui.directives").directive("uiEvent",["$parse",function(a){return function(b,c,d){var f=b.$eval(d.uiEvent);angular.forEach(f,function(d,f){var g=a(d);c.bind(f,function(a){var c=Array.prototype.slice.call(arguments);c=c.splice(1),b.$apply(function(){g(b,{$event:a,$params:c})})})})}}]),angular.module("ui.directives").directive("uiMask",[function(){return{require:"ngModel",link:function(a,b,c,d){d.$render=function(){var f=d.$viewValue||"";b.val(f),b.mask(a.$eval(c.uiMask))},d.$parsers.push(function(a){var c=b.isMaskValid()||angular.isUndefined(b.isMaskValid())&&b.val().length>0;return d.$setValidity("mask",c),c?a:undefined}),b.bind("keyup",function(){a.$apply(function(){d.$setViewValue(b.mask())})})}}}]),angular.module("ui.directives").directive("uiModal",["$timeout",function(a){return{restrict:"EAC",require:"ngModel",link:function(b,c,d,f){c.addClass("modal hide"),c.on("shown",function(){c.find("[autofocus]").focus()}),b.$watch(d.ngModel,function(a){c.modal(a&&"show"||"hide")}),c.on(jQuery.support.transition&&"shown"||"show",function(){a(function(){f.$setViewValue(!0)})}),c.on(jQuery.support.transition&&"hidden"||"hide",function(){a(function(){f.$setViewValue(!1)})})}}}]),angular.module("ui.directives").directive("uiReset",["ui.config",function(a){var b=null;return a.reset!==undefined&&(b=a.reset),{require:"ngModel",link:function(a,c,d,e){var f;f=angular.element('<a class="ui-reset" />'),c.wrap('<span class="ui-resetwrap" />').after(f),f.bind("click",function(c){c.preventDefault(),a.$apply(function(){d.uiReset?e.$setViewValue(a.$eval(d.uiReset)):e.$setViewValue(b),e.$render()})})}}}]),function(){function a(a,b,c,d){angular.forEach(b.split(" "),function(b){var f={type:"map-"+b};google.maps.event.addListener(c,b,function(b){d.trigger(angular.extend({},f,b)),a.$$phase||a.$apply()})})}function b(b,d){c.directive(b,[function(){return{restrict:"A",link:function(c,e,f){c.$watch(f[b],function(b){a(c,d,b,e)})}}}])}var c=angular.module("ui.directives");c.directive("uiMap",["ui.config","$parse",function(b,c){var d="bounds_changed center_changed click dblclick drag dragend dragstart heading_changed idle maptypeid_changed mousemove mouseout mouseover projection_changed resize rightclick tilesloaded tilt_changed zoom_changed",e=b.map||{};return{restrict:"A",link:function(b,f,g){var h=angular.extend({},e,b.$eval(g.uiOptions)),j=new google.maps.Map(f[0],h),k=c(g.uiMap);k.assign(b,j),a(b,d,j,f)}}}]),c.directive("uiMapInfoWindow",["ui.config","$parse","$compile",function(b,c,d){var e="closeclick content_change domready position_changed zindex_changed",f=b.mapInfoWindow||{};return{link:function(b,g,h){var j=angular.extend({},f,b.$eval(h.uiOptions));j.content=g[0];var k=c(h.uiMapInfoWindow),l=k(b);l||(l=new google.maps.InfoWindow(j),k.assign(b,l)),a(b,e,l,g),g.replaceWith("<div></div>");var m=l.open;l.open=function(a,c,e,f,h,i){d(g.contents())(b),m.call(l,a,c,e,f,h,i)}}}}]),b("uiMapMarker","animation_changed click clickable_changed cursor_changed dblclick drag dragend draggable_changed dragstart flat_changed icon_changed mousedown mouseout mouseover mouseup position_changed rightclick shadow_changed shape_changed title_changed visible_changed zindex_changed"),b("uiMapPolyline","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapPolygon","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapRectangle","bounds_changed click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapCircle","center_changed click dblclick mousedown mousemove mouseout mouseover mouseup radius_changed rightclick"),b("uiMapGroundOverlay","click dblclick")}(),angular.module("ui.directives").factory("keypressHelper",["$parse",function(a){var b={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete"},c=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};return function(d,e,f,g){var h,i=[];h=e.$eval(g["ui"+c(d)]),angular.forEach(h,function(b,c){var d,e;e=a(b),angular.forEach(c.split(" "),function(a){d={expression:e,keys:{}},angular.forEach(a.split("-"),function(a){d.keys[a]=!0}),i.push(d)})}),f.bind(d,function(a){var c=a.metaKey||a.altKey,f=a.ctrlKey,g=a.shiftKey,h=a.keyCode;d==="keypress"&&!g&&h>=97&&h<=122&&(h-=32),angular.forEach(i,function(d){var h=d.keys[b[a.keyCode]]||d.keys[a.keyCode.toString()]||!1,i=d.keys.alt||!1,j=d.keys.ctrl||!1,k=d.keys.shift||!1;h&&i==c&&j==f&&k==g&&e.$apply(function(){d.expression(e,{$event:a})})})})}}]),angular.module("ui.directives").directive("uiKeydown",["keypressHelper",function(a){return{link:function(b,c,d){a("keydown",b,c,d)}}}]),angular.module("ui.directives").directive("uiKeypress",["keypressHelper",function(a){return{link:function(b,c,d){a("keypress",b,c,d)}}}]),angular.module("ui.directives").directive("uiKeyup",["keypressHelper",function(a){return{link:function(b,c,d){a("keyup",b,c,d)}}}]),angular.module("ui.directives").directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e,f=c.uiValidate;f=a.$eval(f);if(!f)return;angular.isFunction(f)&&(f={validator:f}),angular.forEach(f,function(a,b){e=function(c){return a(c)?(d.$setValidity(b,!0),c):(d.$setValidity(b,!1),undefined)},d.$formatters.push(e),d.$parsers.push(e)})}}}),angular.module("ui.directives").directive("uiAnimate",["ui.config","$timeout",function(a,b){var c={};return angular.isString(a.animate)?c["class"]=a.animate:a.animate&&(c=a.animate),{restrict:"A",link:function(a,d,e){var f={};e.uiAnimate&&(f=a.$eval(e.uiAnimate),angular.isString(f)&&(f={"class":f})),f=angular.extend({"class":"ui-animate"},c,f),d.addClass(f["class"]),b(function(){d.removeClass(f["class"])},20,!1)}}}]),angular.module("ui.directives").directive("uiSelect2",["ui.config","$http",function(a,b){var c={};return a.select2&&angular.extend(c,a.select2),{require:"?ngModel",compile:function(a,b){var d,e,f,g=a.is("select"),h=b.multiple!==undefined;return a.is("select")&&(e=a.find("option[ng-repeat], option[data-ng-repeat]"),e.length&&(f=e.attr("ng-repeat")||e.attr("data-ng-repeat"),d=jQuery.trim(f.split("|")[0]).split(" ").pop())),function(a,b,e,f){var i=angular.extend({},c,a.$eval(e.uiSelect2));g?(delete i.multiple,delete i.initSelection):h&&(i.multiple=!0);if(f){f.$render=function(){g?b.select2("val",f.$modelValue):h&&!f.$modelValue?b.select2("data",[]):b.select2("data",f.$modelValue)},d&&a.$watch(d,function(a,c,d){if(!a)return;setTimeout(function(){b.select2("val",f.$viewValue),b.trigger("change")})});if(!g){b.bind("change",function(){a.$apply(function(){f.$setViewValue(b.select2("data"))})});if(i.initSelection){var j=i.initSelection;i.initSelection=function(a,b){j(a,function(a){f.$setViewValue(a),b(a)})}}}}e.$observe("disabled",function(a){b.select2(a&&"disable"||"enable")}),a.$watch(e.ngMultiple,function(a){b.select2(i)}),b.val(a.$eval(e.ngModel)),setTimeout(function(){b.select2(i)})}}}}]),angular.module("ui.directives").directive("uiCodemirror",["ui.config","$parse",function(a,b){return"use strict",a.codemirror=a.codemirror||{},{require:"ngModel",link:function(c,d,f,g){if(!d.is("textarea"))throw new Error("ui-codemirror can only be applied to a textarea element");var h,i=b(f.uiCodemirror),j=function(a){var b=a.getValue();b!==g.$viewValue&&(g.$setViewValue(b),c.$apply())},k=function(b){b=angular.extend({},b,a.codemirror);var c=b.onChange;c?b.onChange=function(a){j(a),c(a)}:b.onChange=j,h&&h.toTextArea(),h=CodeMirror.fromTextArea(d[0],b)};k(i()),c.$watch(i,k,!0),g.$formatters.push(function(a){if(angular.isUndefined(a)||a===null)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-codemirror cannot use an object or an array as a model");return a}),g.$render=function(){h.setValue(g.$viewValue)}}}}]),angular.module("ui.directives").directive("uiTinymce",["ui.config",function(a){return a.tinymce=a.tinymce||{},{require:"ngModel",link:function(b,c,d,f){var g,h={onchange_callback:function(a){a.isDirty()&&(a.save(),f.$setViewValue(c.val()),b.$$phase||b.$apply())},handle_event_callback:function(a){return this.isDirty()&&(this.save(),f.$setViewValue(c.val()),b.$$phase||b.$apply()),!0},setup:function(a){a.onSetContent.add(function(a,d){a.isDirty()&&(a.save(),f.$setViewValue(c.val()),b.$$phase||b.$apply())})}};d.uiTinymce?g=b.$eval(d.uiTinymce):g={},angular.extend(h,a.tinymce,g),setTimeout(function(){c.tinymce(h)})}}}]),angular.module("ui.directives").directive("uiIf",[function(){return{transclude:"element",priority:1e3,terminal:!0,restrict:"A",compile:function(a,b,c){return function(a,b,d){b[0].doNotMove=!0;var e=d.uiIf,f,g;a.$watch(e,function(d){f&&(f.remove(),f=null),g&&(g.$destroy(),g=null),d&&(g=a.$new(),c(g,function(a){f=a,b.after(a)})),b.parent().trigger("$childrenChanged")})}}}}]),angular.module("ui.directives").directive("uiScrollfix",["$window",function(a){return"use strict",{link:function(b,c,d){var f=c.offset().top;d.uiScrollfix?d.uiScrollfix.charAt(0)==="-"?d.uiScrollfix=f-d.uiScrollfix.substr(1):d.uiScrollfix.charAt(0)==="+"&&(d.uiScrollfix=f+parseFloat(d.uiScrollfix.substr(1))):d.uiScrollfix=f,angular.element(a).on("scroll.ui-scrollfix",function(){var b;if(angular.isDefined(a.pageYOffset))b=a.pageYOffset;else{var f=document.compatMode&&document.compatMode!=="BackCompat"?document.documentElement:document.body;b=f.scrollTop}!c.hasClass("ui-scrollfix")&&b>d.uiScrollfix?c.addClass("ui-scrollfix"):c.hasClass("ui-scrollfix")&&b<d.uiScrollfix&&c.removeClass("ui-scrollfix")})}}}]),angular.module("ui.directives").directive("uiCalendar",["ui.config","$parse",function(a,b){return a.uiCalendar=a.uiCalendar||{},{require:"ngModel",restrict:"A",scope:{events:"=ngModel"},link:function(c,d,f){function g(){var b,g={header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},eventMouseover:function(a,b,c){c.name!=="agendaDay"&&$(b.target).attr("title",a.title)},events:c.events};f.uiCalendar?b=c.$eval(f.uiCalendar):b={},angular.extend(g,a.uiCalendar,b),d.html("").fullCalendar(g)}var h=b(f.ngModel);g(),c.$watch("events.length",function(a,b){g()},!0)}}}]),angular.module("ui.directives").directive("uiShow",[function(){return function(a,b,c){a.$watch(c.uiShow,function(a,c){a?b.addClass("ui-show"):b.removeClass("ui-show")})}}]).directive("uiHide",[function(){return function(a,b,c){a.$watch(c.uiHide,function(a,c){a?b.addClass("ui-hide"):b.removeClass("ui-hide")})}}]).directive("uiToggle",[function(){return function(a,b,c){a.$watch(c.uiToggle,function(a,c){a?b.removeClass("ui-hide").addClass("ui-show"):b.removeClass("ui-show").addClass("ui-hide")})}}]),angular.module("ui.directives").directive("uiCurrency",["ui.config","currencyFilter",function(a,b){var c={pos:"ui-currency-pos",neg:"ui-currency-neg",zero:"ui-currency-zero"};return a.currency&&angular.extend(c,a.currency),{restrict:"EAC",require:"ngModel",link:function(a,d,e,f){var g,h,i;g=angular.extend({},c,a.$eval(e.uiCurrency)),h=function(a){var c;return c=a*1,c>0?d.addClass(g.pos):d.removeClass(g.pos),c<0?d.addClass(g.neg):d.removeClass(g.neg),c===0?d.addClass(g.zero):d.removeClass(g.zero),a===""?d.text(""):d.text(b(c,g.symbol)),!0},f.$render=function(){i=f.$viewValue,d.val(i),h(i)}}}}]),angular.module("ui.directives").directive("uiDate",["ui.config",function(a){"use strict";var b;return b={},angular.isObject(a.date)&&angular.extend(b,a.date),{require:"?ngModel",link:function(b,c,d,f){var g=function(){return angular.extend({},a.date,b.$eval(d.uiDate))},h=function(){var a=g();if(f){var d=function(){b.$apply(function(){var a=c.datepicker("getDate");c.datepicker("setDate",c.val()),f.$setViewValue(a)})};if(a.onSelect){var e=a.onSelect;a.onSelect=function(a,b){return d(),e(a,b)}}else a.onSelect=d;c.bind("change",d),f.$render=function(){var a=f.$viewValue;if(angular.isDefined(a)&&a!==null&&!angular.isDate(a))throw new Error("ng-Model value must be a Date object - currently it is a "+typeof a+" - use ui-date-format to convert it from a string");c.datepicker("setDate",a)}}c.datepicker("destroy"),c.datepicker(a),f.$render()};b.$watch(g,h,!0)}}}]).directive("uiDateFormat",[function(){var a={require:"ngModel",link:function(a,b,c,d){if(c.uiDateFormat==="")d.$formatters.push(function(a){if(angular.isString(a))return new Date(a)}),d.$parsers.push(function(a){if(a)return a.toISOString()});else{var e=c.uiDateFormat;d.$formatters.push(function(a){if(angular.isString(a))return $.datepicker.parseDate(e,a)}),d.$parsers.push(function(a){if(a)return $.datepicker.formatDate(e,a)})}}};return a}]),angular.module("ui.filters").filter("highlight",function(){return function(a,b,c){return b||angular.isNumber(b)?(a=a.toString(),b=b.toString(),c?a.split(b).join('<span class="ui-match">'+b+"</span>"):a.replace(new RegExp(b,"gi"),'<span class="ui-match">$&</span>')):a}}),angular.module("ui.filters").filter("format",function(){return function(a,b){if(!a)return a;var c=a.toString(),d;return b===undefined?c:!angular.isArray(b)&&!angular.isObject(b)?c.split("$0").join(b):(d=angular.isArray(b)&&"$"||":",angular.forEach(b,function(a,b){c=c.split(d+b).join(a)}),c)}}),angular.module("ui.filters").filter("unique",function(){return function(a,b){if(b===!1)return a;if((b||angular.isUndefined(b))&&angular.isArray(a)){var c={},d=[],e=function(a){return angular.isObject(a)&&angular.isString(b)?a[b]:a};angular.forEach(a,function(a){var b,c=!1;for(var f=0;f<d.length;f++)if(angular.equals(e(d[f]),e(a))){c=!0;break}c||d.push(a)}),a=d}return a}}),angular.module("ui.filters").filter("inflector",function(){function a(a){return a.replace(/^([a-z])|\s+([a-z])/g,function(a){return a.toUpperCase()})}function b(a,b){return a.replace(/[A-Z]/g,function(a){return b+a})}var c={humanize:function(c){return a(b(c," ").split("_").join(" "))},underscore:function(a){return a.substr(0,1).toLowerCase()+b(a.substr(1),"_").toLowerCase().split(" ").join("_")},variable:function(b){return b=b.substr(0,1).toLowerCase()+a(b.split("_").join(" ")).substr(1).split(" ").join(""),b}};return function(a,b,d){return b!==!1&&angular.isString(a)?(b=b||"humanize",c[b](a)):a}}),function(){Function.prototype.scopedTo===void 0&&(Function.prototype.scopedTo=function(a,b){var c=this;return function(){return c.apply(a,Array.prototype.slice.call(b||[]).concat(Array.prototype.slice.call(arguments)))}});var a=function(b,d){this.options=d||{},this.key=b,this.channels=new a.Channels,this.global_emitter=new a.EventsDispatcher;var e=this;this.checkAppKey(),this.connection=new a.Connection(this.key,this.options),this.connection.bind("connected",function(){e.subscribeAll()}).bind("message",function(a){var b=a.event.indexOf("pusher_internal:")===0;if(a.channel){var c;(c=e.channel(a.channel))&&c.emit(a.event,a.data)}b||e.global_emitter.emit(a.event,a.data)}).bind("disconnected",function(){e.channels.disconnect()}).bind("error",function(b){a.warn("Error",b)}),a.instances.push(this),a.isReady&&e.connect()};a.instances=[],a.prototype={channel:function(a){return this.channels.find(a)},connect:function(){this.connection.connect()},disconnect:function(){this.connection.disconnect()},bind:function(a,b){return this.global_emitter.bind(a,b),this},bind_all:function(a){return this.global_emitter.bind_all(a),this},subscribeAll:function(){for(channelName in this.channels.channels)this.channels.channels.hasOwnProperty(channelName)&&this.subscribe(channelName)},subscribe:function(a){var b=this,c=this.channels.add(a,this);return this.connection.state==="connected"&&c.authorize(this.connection.socket_id,this.options,function(d,f){d?c.emit("pusher:subscription_error",f):b.send_event("pusher:subscribe",{channel:a,auth:f.auth,channel_data:f.channel_data})}),c},unsubscribe:function(a){this.channels.remove(a),this.connection.state==="connected"&&this.send_event("pusher:unsubscribe",{channel:a})},send_event:function(a,b,c){return this.connection.send_event(a,b,c)},checkAppKey:function(){(this.key===null||this.key===void 0)&&a.warn("Warning","You must pass your app key when you instantiate Pusher.")}},a.Util={extend:function b(a,c){for(var d in c)a[d]=c[d]&&c[d].constructor&&c[d].constructor===Object?b(a[d]||{},c[d]):c[d];return a},stringify:function(){for(var a=["Pusher"],b=0;b<arguments.length;b++)typeof arguments[b]=="string"?a.push(arguments[b]):window.JSON==void 0?a.push(arguments[b].toString()):a.push(JSON.stringify(arguments[b]));return a.join(" : ")},arrayIndexOf:function(a,b){var c=Array.prototype.indexOf;if(a==null)return-1;if(c&&a.indexOf===c)return a.indexOf(b);for(i=0,l=a.length;i<l;i++)if(a[i]===b)return i;return-1}},a.debug=function(){a.log&&a.log(a.Util.stringify.apply(this,arguments))},a.warn=function(){window.console&&window.console.warn?window.console.warn(a.Util.stringify.apply(this,arguments)):a.log&&a.log(a.Util.stringify.apply(this,arguments))},a.VERSION="1.12.5",a.host="ws.pusherapp.com",a.ws_port=80,a.wss_port=443,a.sockjs_host="sockjs.pusher.com",a.sockjs_http_port=80,a.sockjs_https_port=443,a.sockjs_path="/pusher",a.channel_auth_endpoint="/pusher/auth",a.cdn_http="http://js.pusher.com/",a.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net/",a.dependency_suffix=".min",a.channel_auth_transport="ajax",a.activity_timeout=12e4,a.pong_timeout=3e4,a.isReady=!1,a.ready=function(){a.isReady=!0;for(var b=0,d=a.instances.length;b<d;b++)a.instances[b].connect()},this.Pusher=a}.call(this),function(){function a(){this._callbacks={}}function b(b){this.callbacks=new a,this.global_callbacks=[],this.failThrough=b}a.prototype.get=function(a){return this._callbacks[this._prefix(a)]},a.prototype.add=function(a,b){var c=this._prefix(a);this._callbacks[c]=this._callbacks[c]||[],this._callbacks[c].push(b)},a.prototype.remove=function(a,b){if(this.get(a)){var c=Pusher.Util.arrayIndexOf(this.get(a),b);this._callbacks[this._prefix(a)].splice(c,1)}},a.prototype._prefix=function(a){return"_"+a},b.prototype.bind=function(a,b){return this.callbacks.add(a,b),this},b.prototype.unbind=function(a,b){return this.callbacks.remove(a,b),this},b.prototype.emit=function(a,b){for(var c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b);var d=this.callbacks.get(a);if(d)for(c=0;c<d.length;c++)d[c](b);else this.failThrough&&this.failThrough(a,b);return this},b.prototype.bind_all=function(a){return this.global_callbacks.push(a),this},this.Pusher.EventsDispatcher=b}.call(this),function(){function a(a,b,c){b[a]!==void 0&&b[a](c)}function b(a,b,d){c.EventsDispatcher.call(this),this.state=void 0,this.errors=[],this.stateActions=d,this.transitions=b,this.transition(a)}var c=this.Pusher;b.prototype.transition=function(b,d){var e=this.state,f=this.stateActions;if(e&&c.Util.arrayIndexOf(this.transitions[e],b)==-1)throw this.emit("invalid_transition_attempt",{oldState:e,newState:b}),Error("Invalid transition ["+e+" to "+b+"]");a(e+"Exit",f,d),a(e+"To"+(b.substr(0,1).toUpperCase()+b.substr(1)),f,d),a(b+"Pre",f,d),this.state=b,this.emit("state_change",{oldState:e,newState:b}),a(b+"Post",f,d)},b.prototype.is=function(a){return this.state===a},b.prototype.isNot=function(a){return this.state!==a},c.Util.extend(b.prototype,c.EventsDispatcher.prototype),this.Pusher.Machine=b}.call(this),function(){var a=function(){var a=this;Pusher.EventsDispatcher.call(this),window.addEventListener!==void 0&&(window.addEventListener("online",function(){a.emit("online",null)},!1),window.addEventListener("offline",function(){a.emit("offline",null)},!1))};a.prototype.isOnLine=function(){return window.navigator.onLine===void 0?!0:window.navigator.onLine},Pusher.Util.extend(a.prototype,Pusher.EventsDispatcher.prototype),this.Pusher.NetInfo=a}.call(this),function(){function a(a){a.connectionWait=0,a.openTimeout=c.TransportType==="native"?4e3:c.TransportType==="flash"?7e3:6e3,a.connectedTimeout=2e3,a.connectionSecure=a.compulsorySecure,a.failedAttempts=0}function b(b,i){function k(){x.openTimeout<g&&(x.openTimeout+=e),x.connectedTimeout<h&&(x.connectedTimeout+=f),x.compulsorySecure!==!0&&(x.connectionSecure=!x.connectionSecure),x.failedAttempts++}function l(a){return a=a||document.location.protocol==="https:",(a?"wss://":"ws://")+c.host+":"+(a?c.wss_port:c.ws_port)}function m(a){return a=a||document.location.protocol==="https:",(a?"https://":"http://")+c.sockjs_host+":"+(a?c.sockjs_https_port:c.sockjs_http_port)+c.sockjs_path}function n(){x._machine.transition("impermanentlyClosing")}function o(){x._activityTimer&&clearTimeout(x._activityTimer),x.ping&&(x._activityTimer=setTimeout(function(){x.send_event("pusher:ping",{}),x._activityTimer=setTimeout(function(){x.socket.close()},x.options.pong_timeout||c.pong_timeout)},x.options.activity_timeout||c.activity_timeout))}function p(){var a=x.connectionWait;if(a===0&&x.connectedAt){var b=(new Date).getTime()-x.connectedAt;b<1e3&&(a=1e3-b)}return a}function q(a){a=s(a);if(a!==void 0)if(a.event==="pusher:connection_established")x._machine.transition("connected",a.data.socket_id);else if(a.event==="pusher:error"){var b=a.data.code;x.emit("error",{type:"PusherError",data:{code:b,message:a.data.message}}),b===4e3?(x.compulsorySecure=!0,x.connectionSecure=!0,x.options.encrypted=!0,n()):b<4100?x._machine.transition("permanentlyClosing"):b<4200?(x.connectionWait=1e3,x._machine.transition("waiting")):b<4300?n():x._machine.transition("permanentlyClosing")}}function r(a){o(),a=s(a);if(a!==void 0){c.debug("Event recd",a);switch(a.event){case"pusher:error":x.emit("error",{type:"PusherError",data:a.data});break;case"pusher:ping":x.send_event("pusher:pong",{})}x.emit("message",a)}}function s(a){try{var b=JSON.parse(a.data);if(typeof b.data=="string")try{b.data=JSON.parse(b.data)}catch(c){if(!(c instanceof SyntaxError))throw c}return b}catch(d){x.emit("error",{type:"MessageParseError",error:d,data:a.data})}}function u(){x._machine.transition("waiting")}function v(a){x.emit("error",{type:"WebSocketError",error:a})}function w(a,b){var d=x.state;x.state=a,d!==a&&(c.debug("State changed",d+" -> "+a),x.emit("state_change",{previous:d,current:a}),x.emit(a,b))}var x=this;c.EventsDispatcher.call(this),this.ping=!0,this.options=c.Util.extend({encrypted:!1},i),this.netInfo=new c.NetInfo,this.netInfo.bind("online",function(){x._machine.is("waiting")&&(x._machine.transition("connecting"),w("connecting"))}),this.netInfo.bind("offline",function(){x._machine.is("connected")&&(x.socket.onclose=void 0,x.socket.onmessage=void 0,x.socket.onerror=void 0,x.socket.onopen=void 0,x.socket.close(),x.socket=void 0,x._machine.transition("waiting"))}),this._machine=new c.Machine("initialized",d,{initializedPre:function(){x.compulsorySecure=x.options.encrypted,x.key=b,x.socket=null,x.socket_id=null,x.state="initialized"},waitingPre:function(){x.netInfo.isOnLine()?(x.failedAttempts<2?w("connecting"):(w("unavailable"),x.connectionWait=1e4),x.connectionWait>0&&x.emit("connecting_in",p()),x._waitingTimer=setTimeout(function(){x._machine.transition("connecting")},p())):w("unavailable")},waitingExit:function(){clearTimeout(x._waitingTimer)},connectingPre:function(){if(x.netInfo.isOnLine()===!1)x._machine.transition("waiting"),w("unavailable");else{var a="/app/"+x.key+"?protocol=5&client=js&version="+c.VERSION+"&flash="+(c.TransportType==="flash"?"true":"false");if(c.TransportType==="sockjs"){c.debug("Connecting to sockjs",c.sockjs);var b=m(x.connectionSecure);x.ping=!1,x.socket=new SockJS(b),x.socket.onopen=function(){x.socket.send(JSON.stringify({path:a})),x._machine.transition("open")}}else b=l(x.connectionSecure)+a,c.debug("Connecting",b),x.socket=new c.Transport(b),x.socket.onopen=function(){x._machine.transition("open")};x.socket.onclose=u,x.socket.onerror=v,x._connectingTimer=setTimeout(n,x.openTimeout)}},connectingExit:function(){clearTimeout(x._connectingTimer),x.socket.onopen=void 0},connectingToWaiting:function(){k()},connectingToImpermanentlyClosing:function(){k()},openPre:function(){x.socket.onmessage=q,x.socket.onerror=v,x.socket.onclose=u,x._openTimer=setTimeout(n,x.connectedTimeout)},openExit:function(){clearTimeout(x._openTimer),x.socket.onmessage=void 0},openToWaiting:function(){k()},openToImpermanentlyClosing:function(){k()},connectedPre:function(b){x.socket_id=b,x.socket.onmessage=r,x.socket.onerror=v,x.socket.onclose=u,a(x),x.connectedAt=(new Date).getTime(),o()},connectedPost:function(){w("connected")},connectedExit:function(){x._activityTimer&&clearTimeout(x._activityTimer),w("disconnected")},impermanentlyClosingPost:function(){x.socket&&(x.socket.onclose=u,x.socket.close())},permanentlyClosingPost:function(){x.socket?(x.socket.onclose=function(){a(x),x._machine.transition("permanentlyClosed")},x.socket.close()):(a(x),x._machine.transition("permanentlyClosed"))},failedPre:function(){w("failed"),c.debug("WebSockets are not available in this browser.")},permanentlyClosedPost:function(){w("disconnected")}})}var c=this.Pusher,d={initialized:["waiting","failed"],waiting:["connecting","permanentlyClosed"],connecting:["open","permanentlyClosing","impermanentlyClosing","waiting"],open:["connected","permanentlyClosing","impermanentlyClosing","waiting"],connected:["permanentlyClosing","waiting"],impermanentlyClosing:["waiting","permanentlyClosing"],permanentlyClosing:["permanentlyClosed"],permanentlyClosed:["waiting","failed"],failed:["permanentlyClosed"]},e=2e3,f=2e3,g=1e4,h=1e4;b.prototype.connect=function(){!this._machine.is("failed")&&!c.Transport?this._machine.transition("failed"):this._machine.is("initialized")?(a(this),this._machine.transition("waiting")):this._machine.is("waiting")&&this.netInfo.isOnLine()===!0?this._machine.transition("connecting"):this._machine.is("permanentlyClosed")&&(a(this),this._machine.transition("waiting"))},b.prototype.send=function(a){if(this._machine.is("connected")){var b=this;return setTimeout(function(){b.socket.send(a)},0),!0}return!1},b.prototype.send_event=function(a,b,d){return a={event:a,data:b},d&&(a.channel=d),c.debug("Event sent",a),this.send(JSON.stringify(a))},b.prototype.disconnect=function(){this._machine.is("permanentlyClosed")||(this._machine.is("waiting")||this._machine.is("failed")?this._machine.transition("permanentlyClosed"):this._machine.transition("permanentlyClosing"))},c.Util.extend(b.prototype,c.EventsDispatcher.prototype),this.Pusher.Connection=b}.call(this),function(){Pusher.Channels=function(){this.channels={}},Pusher.Channels.prototype={add:function(a,b){var c=this.find(a);return c||(c=Pusher.Channel.factory(a,b),this.channels[a]=c),c},find:function(a){return this.channels[a]},remove:function(a){delete this.channels[a]},disconnect:function(){for(var a in this.channels)this.channels[a].disconnect()}},Pusher.Channel=function(a,b){var c=this;Pusher.EventsDispatcher.call(this,function(b){Pusher.debug("No callbacks on "+a+" for "+b)}),this.pusher=b,this.name=a,this.subscribed=!1,this.bind("pusher_internal:subscription_succeeded",function(a){c.onSubscriptionSucceeded(a)})},Pusher.Channel.prototype={init:function(){},disconnect:function(){this.subscribed=!1,this.emit("pusher_internal:disconnected")},onSubscriptionSucceeded:function(){this.subscribed=!0,this.emit("pusher:subscription_succeeded")},authorize:function(a,b,c){return c(!1,{})},trigger:function(a,b){return this.pusher.send_event(a,b,this.name)}},Pusher.Util.extend(Pusher.Channel.prototype,Pusher.EventsDispatcher.prototype),Pusher.Channel.PrivateChannel={authorize:function(a,b,c){var d=this;return(new Pusher.Channel.Authorizer(this,Pusher.channel_auth_transport,b)).authorize(a,function(a,b){a||d.emit("pusher_internal:authorized",b),c(a,b)})}},Pusher.Channel.PresenceChannel={init:function(){this.members=new a(this)},onSubscriptionSucceeded:function(){this.subscribed=!0}};var a=function(a){var b=this,c=function(){this._members_map={},this.count=0,this.me=null};c.call(this),a.bind("pusher_internal:authorized",function(c){var d=JSON.parse(c.channel_data);a.bind("pusher_internal:subscription_succeeded",function(c){b._members_map=c.presence.hash,b.count=c.presence.count,b.me=b.get(d.user_id),a.emit("pusher:subscription_succeeded",b)})}),a.bind("pusher_internal:member_added",function(c){b.get(c.user_id)===null&&b.count++,b._members_map[c.user_id]=c.user_info,a.emit("pusher:member_added",b.get(c.user_id))}),a.bind("pusher_internal:member_removed",function(c){var d=b.get(c.user_id);d&&(delete b._members_map[c.user_id],b.count--,a.emit("pusher:member_removed",d))}),a.bind("pusher_internal:disconnected",function(){c.call(b)})};a.prototype={each:function(a){for(var b in this._members_map)a(this.get(b))},get:function(a){return this._members_map.hasOwnProperty(a)?{id:a,info:this._members_map[a]}:null}},Pusher.Channel.factory=function(a,b){var c=new Pusher.Channel(a,b);return a.indexOf("private-")===0?Pusher.Util.extend(c,Pusher.Channel.PrivateChannel):a.indexOf("presence-")===0&&(Pusher.Util.extend(c,Pusher.Channel.PrivateChannel),Pusher.Util.extend(c,Pusher.Channel.PresenceChannel)),c.init(),c}}.call(this),function(){Pusher.Channel.Authorizer=function(a,b,c){this.channel=a,this.type=b,this.authOptions=(c||{}).auth||{}},Pusher.Channel.Authorizer.prototype={composeQuery:function(a){var a="&socket_id="+encodeURIComponent(a)+"&channel_name="+encodeURIComponent(this.channel.name),b;for(b in this.authOptions.params)a+="&"+encodeURIComponent(b)+"="+encodeURIComponent(this.authOptions.params[b]);return a},authorize:function(a,b){return Pusher.authorizers[this.type].call(this,a,b)}},Pusher.auth_callbacks={},Pusher.authorizers={ajax:function(a,b){var c;c=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c.open("POST",Pusher.channel_auth_endpoint,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var d in this.authOptions.headers)c.setRequestHeader(d,this.authOptions.headers[d]);return c.onreadystatechange=function(){if(c.readyState==4)if(c.status==200){var a,d=!1;try{a=JSON.parse(c.responseText),d=!0}catch(e){b(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+c.responseText)}d&&b(!1,a)}else Pusher.warn("Couldn't get auth info from your webapp",c.status),b(!0,c.status)},c.send(this.composeQuery(a)),c},jsonp:function(a,b){this.authOptions.headers!==void 0&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var c=document.createElement("script");Pusher.auth_callbacks[this.channel.name]=function(a){b(!1,a)},c.src=Pusher.channel_auth_endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+this.channel.name+"']")+this.composeQuery(a);var d=document.getElementsByTagName("head")[0]||document.documentElement;d.insertBefore(c,d.firstChild)}}}.call(this);var _require=function(){function a(a,b){document.addEventListener?a.addEventListener("load",b,!1):a.attachEvent("onreadystatechange",function(){(a.readyState=="loaded"||a.readyState=="complete")&&b()})}function b(b,d){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.setAttribute("src",b),f.setAttribute("type","text/javascript"),f.setAttribute("async",!0),a(f,function(){d()}),e.appendChild(f)}return function(a,c){for(var d=0,e=0;e<a.length;e++)b(a[e],function(){a.length==++d&&setTimeout(c,0)})}}();(function(){!window.WebSocket&&window.MozWebSocket&&(window.WebSocket=window.MozWebSocket),window.WebSocket&&(Pusher.Transport=window.WebSocket,Pusher.TransportType="native");var a=(document.location.protocol=="http:"?Pusher.cdn_http:Pusher.cdn_https)+Pusher.VERSION,b=[];window.JSON||b.push(a+"/json2"+Pusher.dependency_suffix+".js"),window.WebSocket||(window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,b.push(a+"/flashfallback"+Pusher.dependency_suffix+".js"));var c=function(){return window.WebSocket?function(){Pusher.ready()}:function(){window.WebSocket?(Pusher.Transport=window.WebSocket,Pusher.TransportType="flash",window.WEB_SOCKET_SWF_LOCATION=a+"/WebSocketMain.swf",WebSocket.__addTask(function(){Pusher.ready()}),WebSocket.__initialize()):(sockjsPath=a+"/sockjs"+Pusher.dependency_suffix+".js",_require([sockjsPath],function(){Pusher.Transport=SockJS,Pusher.TransportType="sockjs",Pusher.ready()}))}}(),d=function(a){var b=function(){document.body?a():setTimeout(b,0)};b()},e=function(){d(c)};b.length>0?_require(b,e):e()})(),"use strict";var Ninja=function(a){var b=this;this.Options={accessToken:undefined,userAccessToken:undefined,server:"https://a.ninja.is",streamServer:"https://stream.ninja.is",version:0,debug:!1},this.ServerUrl=function(){var a=this.Options.server+"/rest/v"+this.Options.version;return a},this.StreamServerUrl=function(){var a=this.Options.streamServer+"/rest/v"+this.Options.version;return a};var c=function(){var a=b;this.getAuthSlug=function(b){var c=b?"&":"?",d=this.GetMode();switch(d){case Ninja.AuthenticationModes.ACCESS_TOKEN:return c+"access_token="+a.Options.accessToken;case Ninja.AuthenticationModes.USER_ACCESS_TOKEN:return c+"user_access_token="+a.Options.userAccessToken;case Ninja.AuthenticationModes.SESSION:return"";default:return""}},this.GetMode=function(){return a.Options[Ninja.AuthenticationModes.ACCESS_TOKEN]?Ninja.AuthenticationModes.ACCESS_TOKEN:a.Options[Ninja.AuthenticationModes.USER_ACCESS_TOKEN]?Ninja.AuthenticationModes.USER_ACCESS_TOKEN:Ninja.AuthenticationModes.SESSION}},d=function(a){var c=b;this.Options={},this.Options=Ninja.Utilities.ObjectMerge(this.Options,a),this.GetInfo=function(a){var b=c.ServerUrl()+"/user"+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){a&&a(b)},this);return d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.send(),!0};var d=function(a){c.Options.debug&&console.log(a)};this.GetStream=function(a){var b=c.ServerUrl()+"/user/stream"+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){a&&a(b)},this);return d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.send(),!0},this.GetPusherChannel=function(a){var b=c.ServerUrl()+"/user/pusherchannel"+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){b.result&&a&&a(b)});return d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.send(),!0},this.GetPreferences=function(a){var b=c.ServerUrl()+"/user/preferences"+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){b.result&&a&&a(b.data)});return d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.send(),!0},this.SetPreferences=function(a,b){var d=c.ServerUrl()+"/user/preferences"+c.Authentication.getAuthSlug(),e=Ninja.Utilities.CreateXHR(function(a){a.result?b&&b(!0):b&&b(!1)});return e.open("PUT",d,!0),e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(a)),!0},this.GetBlocks=function(a){c.Options.debug&&console.log("GetBlocks");var b=c.ServerUrl()+"/blocks"+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){if(b.result){var d=c.API.ParseBlocks(b.data);a&&a(d)}});d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.send()},this.GetDevices=function(a){c.Options.debug&&console.log("GetDevices ");var b=c.ServerUrl()+"/devices"+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){if(b.result){var d=c.API.ParseDevices(b.data);a&&a(d)}},this);d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.send()},this.CreateService=function(a,b){var d=c.ServerUrl()+"/service/"+a+c.Authentication.getAuthSlug(),e=Ninja.Utilities.CreateXHR(function(a){if(a.result){var d=a.data;c.API.GetDeviceByGuid(d.GUID,function(a){var d={};d[a.guid]=a;var e=c.API.ParseDevices(d);b&&b(e.devices[0],e.blocks[0])})}});e.open("PUT",d,!0),e.setRequestHeader("Accept","application/json"),e.send()}},e=function(){var a=b;this.GetDeviceByGuid=function(b,c){var d=a.ServerUrl()+"/device/"+b+a.Authentication.getAuthSlug(),e=Ninja.Utilities.CreateXHR(function(a){a.result&&c&&c(a.data)});e.open("GET",d,!0),e.setRequestHeader("Accept","application/json"),e.send()},this.ParseBlocks=function(b){var c=[];for(var d in b)if(b.hasOwnProperty(d)){var e=b[d],f=new a.Block({nodeId:d});c.push(f)}return c},this.ParseDevices=function(b){var c=[],d=[],e=function(b){var c;for(var e=0;e<d.length;e++){var f=d[e];f.Options.nodeId===b&&(c=f)}return c===undefined&&(c=new a.Block({nodeId:b}),d.push(c)),c};for(var f in b)if(b.hasOwnProperty(f)){var g=b[f],h=Ninja.Utilities.SplitGUID(f),i=e(h.nodeId),j=new a.Device({deviceId:h.deviceId,type:g.device_type,name:g.shortName,vendor:g.vid,port:g.gid,rawData:g});i.RegisterDevice(j);for(var k in g.subDevices){var l=new a.Subdevice(g.subDevices[k]);l.Id=k,j.Options.subdevices.push(l)}c.push(j)}return{blocks:d,devices:c}}};this.Block=function(a){var c=b,d,e,f=0;this.Devices=[],this.Options={nodeId:undefined,token:undefined,listenInterval:300},this.Options=Ninja.Utilities.ObjectMerge(this.Options,a),this.Claim=function(a){var b={nodeid:this.Options.nodeId},d=c.ServerUrl()+"/block"+c.Authentication.getAuthSlug(),e=Ninja.Utilities.CreateXHR(function(b){b.result?a&&a(!0):a&&a(!1)},this);e.open("POST",d,!0),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(b))},this.Activate=function(a){function h(){}var b={nodeid:this.Options.nodeId},d=c.ServerUrl()+"/block/"+this.Options.nodeId+"/activate",e,f=Ninja.Utilities.CreateXHR(function(b){this.Options.token=b.token,a&&a(b.token)},this);f.open("GET",d,!0),xhr.setRequestHeader("Accept","application/json"),f.send();var g=function(){f=undefined,clearInterval(e),this.Activate()}},this.ConfirmActivation=function(a){var b={token:this.Options.token},d=c.ServerUrl()+"/block/"+this.Options.nodeId+"/activate",e=Ninja.Utilities.CreateXHR(function(b){b.result&&a&&a(b.token)});e.open("POST",d,!0),xhr.setRequestHeader("Accept","application/json"),e.send(JSON.stringify(b))},this.Unpair=function(a){var b=c.ServerUrl()+"/block/"+this.Options.nodeId+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){b.result&&a&&a(b.data)});d.open("DELETE",b,!0),d.setRequestHeader("Accept","application/json"),d.send()},this.HeartBeat=function(a){},this.IsListening=function(){return d!==undefined&&e!==undefined&&e.readyState===3},this.ParseCommands=function(){if(e&&e.readyState===4){var a=e.responseText.length;if(f===a&&f!==0)return;var b=e.responseText.substring(f,a);f=a;var c=b.split("\n");for(var d=0;d<c.length;d++){var g=c[d];if(g!==""){var h=JSON.parse(g);this.BroadcastCommand(h)}}this.Stop(),this.Listen()}},this.ListenErrorHandler=function(){this.Stop(),this.Listen()},this.Listen=function(a){if(this.Options.token===undefined)return!1;var b=c.ServerUrl()+"/block/"+this.Options.nodeId+"/commands";if(!e){try{e=Ninja.Utilities.CreateXHR(this.ParseCommands,this),e.open("GET",b,!0),e.setRequestHeader("X-Ninja-Token",this.Options.token),e.addEventListener("error",this.ListenErrorHandler.bind(this),!1),e.addEventListener("abort",this.ListenErrorHandler.bind(this),!1),e.addEventListener("load",this.ParseCommands.bind(this),!1),e.send()}catch(d){return!1}return!0}return!1},this.Stop=function(){return f=0,e=undefined,clearInterval(d),d=undefined,!0},this.BroadcastCommand=function(a){if(a.DEVICE){var b=a.DEVICE;for(var c=0;c<b.length;c++){var d=b[c],e=this.GetDeviceByPortVendorDeviceID(d.G,d.V,d.D);e.Actuate(d.DA)}}},this.RegisterDevice=function(a){a.Options.block=this,this.Devices.push(a)},this.GetDevices=function(){return this.Devices},this.GetDevicesByType=function(a){var b=[];for(var c=0;c<this.Devices.length;c++){var d=this.Devices[c];d.Options.type===a&&b.push(d)}return b},this.GetDevicesByDeviceId=function(a){var b=[];for(var c=0;c<this.Devices.length;c++){var d=this.Devices[c];d.Options.deviceId===a&&b.push(d)}return b},this.GetDeviceByPortVendorDeviceID=function(a,b,c){var d={};for(var e=0;e<this.Devices.length;e++){var f=this.Devices[e];f.Options.vendor===b&&f.Options.port==a.toString()&&f.Options.deviceId==c&&(d=f)}return d},this.GetDeviceByGuid=function(a){var b={};for(var c=0;c<this.Devices.length;c++){var d=this.Devices[c];d.GUID()===a&&(b=d)}return b}},this.Device=function(a){var c=b;this.GUID=function(){return this.Options.hasOwnProperty("guid")?this.Options.guid:this.Options.block?this.Options.block.Options.nodeId+"_"+this.Options.port+"_"+this.Options.vendor+"_"+this.Options.deviceId:"Not associated with a block. Please Register this device"};var d=function(){if(parseInt(this.Options.deviceId)===31||parseInt(this.Options.deviceId)===30){var a=this.Options.port.toString().substring(0,2),b=this.Options.port.toString().substring(2,4);this.Options.station=a,this.Options.channel=b}};this.AutoLoadData=function(){this.GetData(this.LoadData.bind(this))},this.LoadData=function(a){var b=new c.Block({nodeId:a.node});this.Options.rawData=a,this.Options.deviceId=parseInt(a.did,10),this.Options.vendor=parseInt(a.vid),this.Options.port=a.gid,this.Options.type=a.device_type,this.Options.name=a.default_name,a.last_data&&a.last_data.hasOwnProperty("DA")&&(this.Options.value=a.last_data.DA)},this.Emit=function(a,b){var d=c.ServerUrl()+"/device/"+this.GUID()+c.Authentication.getAuthSlug();a={DA:a};var e=Ninja.Utilities.CreateXHR(function(a){b&&b(a)},this);return e.open("PUT",d,!0),e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(a)),!0},this.Options={name:"",type:Ninja.DeviceTypes.UNDEFINED,deviceId:0,vendor:0,port:0,block:undefined,value:undefined,subdevices:[],onActuate:function(){throw".onActuate() not implemented."}},this.on=function(a,b){},this.Delete=function(a){var b=c.ServerUrl()+"/device/"+this.GUID()+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){a&&a(b)},this);d.open("DELETE",b,!0),d.setRequestHeader("Accept","application/json"),d.send()},this.GetHistoricalData=function(a,b){var d=Ninja.Utilities.ObjectToQueryString(a),e=c.ServerUrl()+"/device/"+this.GUID()+"/data?"+d+c.Authentication.getAuthSlug(d.length>0),f=Ninja.Utilities.CreateXHR(function(a){a.result&&b&&b(a.data)});f.open("GET",e,!0),f.setRequestHeader("Accept","application/json"),f.send()},this.GetData=function(a){var b=c.ServerUrl()+"/device/"+this.GUID()+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){b.result&&a&&a(b.data)},this);d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.send()},this.GetCallback=function(a){var b=c.ServerUrl()+"/device/"+this.GUID()+"/callback"+c.Authentication.getAuthSlug(),d=Ninja.Utilities.CreateXHR(function(b){b.result&&a&&a(b.data)});d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.send()},this.SetCallback=function(a,b){var d=c.ServerUrl()+"/device/"+this.GUID()+"/callback"+c.Authentication.getAuthSlug(),e=Ninja.Utilities.CreateXHR(function(a){a.result&&b&&b()});if(a!==null){var f={url:a};e.open("POST",d,!0),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(f))}else e.open("DELETE",d,!0),e.setRequestHeader("Accept","application/json"),e.send()},this.Rename=function(a,b){var d={shortName:a},e=c.ServerUrl()+"/device/"+this.GUID()+c.Authentication.getAuthSlug(),f=Ninja.Utilities.CreateXHR(function(a){a.result&&b&&b()});f.open("PUT",e,!0),f.setRequestHeader("Accept","application/json"),f.setRequestHeader("Content-Type","application/json"),f.send(JSON.stringify(d))},this.SetSubdevice=function(a,b){if(!(a instanceof c.Subdevice))return!1;var d,e;a.Id?(d=c.ServerUrl()+"/device/"+this.GUID()+"/subdevice/"+a.Id+c.Authentication.getAuthSlug(),e=Ninja.Utilities.CreateXHR(function(a){a.result?b&&b(!0):b&&b(!1)}),e.open("PUT",d,!0)):(d=c.ServerUrl()+"/device/"+this.GUID()+"/subdevice"+c.Authentication.getAuthSlug(),e=Ninja.Utilities.CreateXHR(function(a){a.result?b&&b(a.data):b&&b(!1)}),e.open("POST",d,!0)),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Accept","application/json"),e.send(JSON.stringify(a.Options))},this.GetSubdeviceById=function(a,b){var c;for(var d in this.Options.subdevices){var e=this.Options.subdevices[d];if(d.Id==a){c=e;break}}return c},this.DeleteSubdevice=function(a,b){if(a instanceof c.Subdevice){if(!a.Id)return b&&b(!1),!1;var d=c.ServerUrl()+"/device/"+this.GUID()+"/subdevice/"+a.Id+c.Authentication.getAuthSlug(),e=Ninja.Utilities.CreateXHR(function(c){var d=this.Options.subdevices.indexOf(a);this.Options.subdevices.splice(d,1),b&&b(c.result?!0:!1)}.bind(this));e.open("DELETE",d,!0),e.setRequestHeader("Accept","application/json"),e.send()}},this.HasMetaData=function(){return Ninja.Utilities.ObjectIsDefined(this.GetMetaData())},this.GetMetaData=function(){return this.Options.rawData&&this.Options.rawData.meta?this.Options.rawData.meta:{}},this.Options=Ninja.Utilities.ObjectMerge(this.Options,a),this.Actuate=this.Options.onActuate,d.bind(this)(),this.Options.hasOwnProperty("guid")&&this.AutoLoadData()},this.Subdevice=function(a){var c=b;this.Id=null,this.Options={category:"",shortName:"",data:null,type:null};var d=function(a){switch(a.Options.category){case Ninja.SubdeviceCategories.RF:break;case Ninja.SubdeviceCategories.WEBHOOK:break;case Ninja.SubdeviceCategories.SMS:}},e=function(a){return a.Options.category===""?!1:a.Options.type===null||a.Options.type===""||a.Options.type===undefined?!1:!0};this.Options=Ninja.Utilities.ObjectMerge(this.Options,a);if(!e(this))return this;d(this)},this.App=function(a){var c=b,d=null;this.Options={name:"",redirectUri:null,secret:null},this.Save=function(a){var b,d={name:this.Options.name,redirect_uri:this.Options.redirectUri},f;this.Id?(f="PUT",d.id=this.Id,b=c.ServerUrl()+"/app/"+this.Id+c.Authentication.getAuthSlug()):(f="POST",b=c.ServerUrl()+"/app"+c.Authentication.getAuthSlug());var g=Ninja.Utilities.CreateXHR(function(b){b.result&&(e(b.data),a&&a(b.data))});g.open(f,b,!0),g.setRequestHeader("Content-Type","application/json"),g.setRequestHeader("Accept","application/json"),g.send(JSON.stringify(d))};var e=function(a){this.Id=a.id?a.id:null,this.Options.secret=a.secret?a.secret:null};this.Delete=function(){var a=c.ServerUrl()+"/app/"+this.Id+c.Authentication.getAuthSlug(),b=Ninja.Utilities.CreateXHR(function(a){});b.open("DELETE",a,!0),b.setRequestHeader("Accept","application/json"),b.send()},this.Options=Ninja.Utilities.ObjectMerge(this.Options,a)},this.Authentication=new c,this.API=new e,this.Options=Ninja.Utilities.ObjectMerge(this.Options,a),this.User=new d};Ninja.AuthenticationModes={USER_ACCESS_TOKEN:"userAccessToken",ACCESS_TOKEN:"accessToken",SESSION:"session"},Ninja.DeviceTypes={UNDEFINED:"undefined",BUTTON:"button",RGBLED:"rgbled",TEMPERATURE:"temperature",HUMIDITY:"humidity",RF433:"rf433",MOTION:"motion",DISTANCE:"distance",WEBSERVICE:"webservice",ORIENTATION:"orientation",LOCATION:"location",ACCELERATION:"acceleration",PROXIMITY:"proximity",SOUND:"sound",WEBCAM:"webcam",EMAIL:"email",TWILIO:"twilio",SMS:"sms",WEBHOOK:"webhook",FACEBOOK:"facebook",TWITTER:"twitter",NETWORK:"network"},Ninja.DeviceModes={ACTUATOR:"actuator",SENSOR:"sensor"},Ninja.DeviceDataFunctions={MEAN:"mean",SUM:"sum",MINIMUM:"min",MAXIMUM:"max",STDDEV:"stddev",SUMSQ:"ss",COUNT:"count"},Ninja.DeviceDataIntervals={MINUTE:"min",HOUR:"hour",DAY:"day",MONTH:"month",YEAR:"year"},Ninja.SubdeviceCategories={EMAIL:"email",RF:"rf",WEBHOOK:"webhook",SMS:"sms"},Ninja.SubdeviceTypes={ACTUATOR:"actuator",SENSOR:"sensor"},Ninja.Utilities={ObjectMerge:function(a,b){for(var c in b)try{b[c].constructor==Object?a[c]=this.ObjectMerge(a[c],b[c]):a[c]=b[c]}catch(d){a[c]=b[c]}return a},ObjectToQueryString:function(a){var b="",c=[];for(var d in a)try{d&&a[d]&&(b=d+"="+a[d],c.push(b))}catch(e){}return c.join("&")},ObjectArrayToArray:function(a,b){var c=[];b||(b="id");for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];e[b]=d,c.push(e)}return c},ObjectIsDefined:function(a){var b=!1;for(var c in a)try{c&&a[c]&&(b=!0)}catch(d){b=!1}return b},CreateXHR:function(a,b){var c;if(window.ActiveXObject)try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(d){c=null}else c=new XMLHttpRequest;return c.onreadystatechange=function(d){c.readyState===4&&c.responseText&&(a&&b?a.call(b,JSON.parse(c.responseText)):a&&a(JSON.parse(c.responseText)))},c},SplitGUID:function(a){var b=a.split("_"),c=b[0],d=b[1],e=b[2],f=b[3];return{nodeId:c,port:d,vendor:e,deviceId:f}}},Ninja.Result=function(a){var b=!1,c="",d,e;return arguments.length===3?(b=arguments[0],c=arguments[1],d=arguments[2]):arguments.length===2?(b=arguments[0],b?d=arguments[1]:c=arguments[1]):arguments.length===1&&(a.result&&(b=a.result),a.message&&(c=a.message),a.payload&&(d=a.payload)),e={result:b,message:c,payload:d},e},"use strict";var yeomanApp=angular.module("yeomanApp",[]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/selectButton",{templateUrl:"views/selectButton.html",controller:"SelectButtonCtrl"}).when("/existingDevices",{templateUrl:"views/existingDevices.html",controller:"ExistingDevicesCtrl"}).when("/configureLed",{templateUrl:"views/configureLed.html",controller:"ConfigureLedCtrl"}).when("/configureRelay",{templateUrl:"views/configureRelay.html",controller:"ConfigureRelayCtrl"}).when("/configureSocket",{templateUrl:"views/configureSocket.html",controller:"ConfigureSocketCtrl"}).otherwise({redirectTo:"/"})}]).config(["$locationProvider",function(a){a.html5Mode(!1)}]);yeomanApp.run(["$rootScope","$location","UIEvents","NinjaService","UserService","PusherService","DeviceService","UserStore","Button",function(a,b,c,d,e,f,g,h,i){a.setRoute=function(a){b.path(a)},e.GetLoginStatus(),e.GetInfo(),h.GetData(function(a){console.log("UserStore:",a)}),g.LoadUserDevices(function(){}),a.$on(c.SetDeviceType,function(a,b){})}]),yeomanApp.value("UserStoreUrl","/user/store"),yeomanApp.factory("Button",["$rootScope","NinjaService","NinjaUtilities","UIEvents",function(a,b,c,d){return function(e){this.Options={name:"",color:"",device:null,value1:null,value2:null},this.Options=c.ObjectMerge(this.Options,e),this.Construct=function(){if(this.Options.hasOwnProperty("deviceGuid")){var a=new b.Device({guid:this.Options.deviceGuid});this.Options.device=a}},this.GetDevice=function(){return this.Options.device}.bind(this),this.SetDevice=function(a){return this.Options.device=a,!0}.bind(this),this.HasValue=function(a){var b=this.Options["value"+a];return b&&b.toString()==="0"?!0:b?!0:!1},this.Delete=function(){a.$broadcast(d.ButtonRemoving,this)},this.Actuate=function(){this.Options.device.Emit(g.call(this))},this.ActuateOn=function(){this.Options.device.Emit(this.Options.value1)},this.ActuateOff=function(){this.Options.device.Emit(this.Options.value2)};var f="value1",g=function(){if(this.Options.value1&&this.Options.value2){var a=this.Options[f];return f=="value1"?f="value2":f="value1",a}return this.Options.value1};this.Construct()}}]),yeomanApp.factory("Guid",[function(){return function(){var a=function(){return Math.floor(Math.random()*65536).toString(16)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}]),"use strict",yeomanApp.controller("MainCtrl",["$scope","$rootScope","UIEvents","UserStore","NewButtonService",function(a,b,c,d,e){a.ConfigureMode=!1,a.Buttons=d.GetButtons(),a.EditButton=function(b){var c=b.GetDevice().Options.type;console.log("Editing Button ",c),e.Button=b;switch(c){case Ninja.DeviceTypes.RGBLED:a.setRoute("/configureLed");break;case Ninja.DeviceTypes.RELAY:a.setRoute("/configureRelay");break;case Ninja.DeviceTypes.RF433:a.setRoute("/configureSocket")}},a.$watch("UserStore.Data.Buttons",function(){a.Buttons=d.GetButtons()}),a.$on(c.SetConfigureMode,function(b,c){a.ConfigureMode=c}),b.$on(c.ButtonRemoved,function(b,c){a.Buttons=d.GetButtons()})}]),"use strict",yeomanApp.controller("HeaderCtrl",["$scope","$rootScope","$location","UIEvents",function(a,b,c,d){a.ConfigureMode=!1,a.LocationIsHome=function(){return c.$$path=="/"},a.SetConfigureMode=function(c){a.ConfigureMode=c,b.$broadcast(d.SetConfigureMode,a.ConfigureMode)},b.$on(d.SetConfigureMode,function(b,c){a.ConfigureMode=c})}]),"use strict",yeomanApp.controller("DebugCtrl",["$scope",function(a){}]),"use strict",yeomanApp.controller("ButtonCtrl",function(a){}),"use strict",yeomanApp.controller("SelectButtonCtrl",["$scope","$rootScope","UIEvents","NewButtonService",function(a,b,c,d){a.setExistingDeviceType=function(b){a.CreateNewButton(),d.Type=b,a.setRoute("/existingDevices")},a.CreateNewButton=function(){d.Reset()},b.$broadcast(c.SetConfigureMode,!1)}]),"use strict",yeomanApp.service("Config",["$rootScope","$location",function(a,b){var c={YEOMAN:"Yeoman",LOCALHOST:"Localhost",DERP:"Derp",STAGING:"Staging",PRODUCTION:"Production"},d={Mode:c.YEOMAN,Server:"http://localhost:8000",StreamServer:"http://localhost:8000"},e={Mode:c.LOCALHOST,Server:"",StreamServer:""},f={Mode:c.DERP,Server:"",StreamServer:""},g={Mode:c.STAGING,Server:"",StreamServer:""},h={Mode:c.PRODUCTION,Server:"",StreamServer:""},i=function(){var a;switch(b.$$host){case"localhost":b.$$port===3501?a=c.YEOMAN:b.$$port===8e3&&(a=c.LOCALHOST);break;case"derp.local":a=c.DERP;break;case"staging.ninja.is":a=c.STAGING;break;default:a=c.PRODUCTION}return a};switch(i()){case c.YEOMAN:return d;case c.LOCALHOST:return e;case c.DERP:return f;case c.STAGING:return g;case c.PRODUCTION:return h}}]),"use strict",yeomanApp.service("NinjaService",["Config",function(a){var b={server:a.Server,streamServer:a.StreamServer,debug:!1};a.UserAccessToken&&a.UserAccessToken.length>0&&(b.userAccessToken=a.UserAccessToken);var c=new Ninja(b);return c}]),"use strict",yeomanApp.service("NinjaUtilities",function(){return Ninja.Utilities}),"use strict",yeomanApp.service("DeviceService",["$rootScope","$timeout","UIEvents","NinjaService","NinjaUtilities",function(a,b,c,d,e){var f={Devices:[],Blocks:[],LoadUserDevices:function(a){console.log("LoadUserDevices"),d.User.GetDevices(this.SetUserDevices.bind(this)),a&&d.User.GetDevices(a)},FilterUserDevices:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c],e,f;if(parseInt(d.Options.deviceId)===30){e=this.GetDeviceByDeviceId(30,b),f=!1;for(var g=0;g<e.length;g++){var h=e[g];h.Options.port===d.Options.port&&(f=!0)}f||b.push(d)}else if(parseInt(d.Options.deviceId)===31){e=this.GetDeviceByDeviceId(31,b),f=!1;for(var g=0;g<e.length;g++){var h=e[g];h.Options.port===d.Options.port&&(f=!0)}f||b.push(d)}else b.push(d)}return b},SetUserDevices:function(b){this.Devices=this.FilterUserDevices(b.devices),this.Blocks=b.blocks,a.$broadcast(c.DevicesLoaded,this.Devices)},CreateAddDevice:function(b){var f=e.SplitGUID(b.GUID),g=this.GetCreateBlockByNodeId(f.nodeId),h=new d.Device({deviceId:f.deviceId,name:"New Device (TODO: Lookup)",vendor:b.V,port:b.G,value:b.DA,pusherData:b});g.RegisterDevice(h);var i=function(a){h.Options.rawData=a,h.Options.type=a.device_type,h.Options.name=a.default_name,h.Options.rawData.shortName=a.default_name};h.GetData(i.bind(this));var j=this.Devices.slice();j.push(h),j=this.FilterUserDevices(j),j.length!==this.Devices.length&&this.Devices.push(h),a.$apply(),a.$broadcast(c.IsotopeReLayout)},GetCreateBlockByNodeId:function(a){var b;if(this.Blocks)for(var c=0;c<this.Blocks.length;c++){var e=this.Blocks[c];e.Options.nodeId===a&&(b=e)}return b===undefined&&(b=new d.Block({nodeId:a}),this.Blocks.push(b)),b},GetDeviceByNodeId:function(a,b){var c=[];b||(b=this.Devices);if(b)for(var d=0;d<b.length;d++){var e=b[d];e.Options.block.Options.nodeId===a&&c.push(e)}return c},GetDeviceByGuid:function(a,b){b||(b=this.Devices);if(b)for(var c=0;c<b.length;c++){var d=b[c];if(d.GUID()===a)return d}return null},GetDeviceByType:function(a,b){var c=[];b||(b=this.Devices);if(b)for(var d=0;d<b.length;d++){var e=b[d];e.Options.type===a&&c.push(e)}return c},GetDeviceByMode:function(a,b){var c=[];b||(b=this.Devices);if(b)for(var d=0;d<b.length;d++){var e=b[d];e.Options.mode===a&&c.push(e)}return c},GetDeviceByDeviceId:function(a,b){var c=[];b||(b=this.Devices);if(b)for(var d=0;d<b.length;d++){var e=b[d];parseInt(e.Options.deviceId)===parseInt(a)&&c.push(e)}return c},GetWebService:function(a,b){var c,e=this,f=this.GetDeviceByType(a);return f.length===0?d.User.CreateService(a,function(a,c){e.Devices.push(a),e.Blocks.push(c),b&&b(a)}):(c=f[0],b&&b(c)),c}};return a.$on(c.PusherData,function(a,b){var c=f.GetDeviceByGuid(b.GUID);c||f.CreateAddDevice(b)}),a.$on(c.DeviceRemoved,function(b,d){var e=f.GetDeviceByGuid(d.GUID()),g=f.Devices.indexOf(e);f.Devices.splice(g,1),a.$emit(c.IsotopeReLayout,d)}),f}]),"use strict",yeomanApp.service("PusherService",["$rootScope","UIEvents","NinjaService","UserService",function(a,b,c,d){var e,f;a.$on(b.UserInfoLoaded,function(c,d){if(d.error)return;var g=d.pusherKey;e=new Pusher(g),f=e.subscribe(d.pusherChannel),e.log=function(a){console.log(a)};var h=function(c){a.$broadcast(b.PusherHeartbeat,c)},i=function(c){a.$broadcast(b.PusherData,c)},j=function(c){a.$broadcast(b.PusherStream,c)},k=function(c){switch(c.type){case"NODE_ACTIVATION":break;case"PLUGIN":a.$broadcast(b.DevicePlugin,c);break;case"UNPLUG":a.$broadcast(b.DeviceUnplug,c);break;default:a.$broadcast(b.PusherConfig,c)}};f.bind("heartbeat",h),f.bind("data",i),f.bind("stream",j),f.bind("config",k)})}]),"use strict",yeomanApp.service("UIEvents",function(){var a={PusherData:"PusherData",PusherHeartbeat:"PusherHeartbeat",PusherConfig:"PusherConfig",PusherStream:"PusherStream",ConfigureMode:"ConfigureMode",UserIsLoggedIn:"UserIsLoggedIn",UserIsLoggedOut:"UserIsLoggedOut",UserStatusChecked:"UserStatusChecked",UserLoggingIn:"UserLoggingIn",UserLogin:"UserLogin",UserLoginFailed:"UserLoginFailed",UserLoggingOut:"UserLoggingOut",UserLogout:"UserLogout",UserLogoutFailed:"UserLogoutFailed",UserInfoLoading:"UserInfoLoading",UserInfoLoaded:"UserInfoLoaded",UserInfoLoadFailed:"UserInfoLoadFailed",DevicePlugin:"DevicePlugin",DeviceUnplug:"DeviceUnplug",DevicesLoading:"DevicesLoading",DevicesLoaded:"DevicesLoaded",DevicesLoadFailed:"DevicesLoadFailed",DeviceRemoving:"DeviceRemoving",DeviceRemoved:"DeviceRemoved",DeviceRemoveFailed:"DeviceRemoveFailed",ButtonRemoving:"ButtonRemoving",ButtonRemoved:"ButtonRemoved",ButtonRemoveFailed:"ButtonRemoteFailed",SetDeviceType:"SetDeviceType",ServiceUpdated:"ServiceUpdated"};return a}),"use strict",yeomanApp.factory("UserService",["$rootScope","$q","$http","Config","UIEvents","NinjaService",function(a,b,c,d,e,f){var g={InfoDeferred:b.defer(),GetInfo:function(){f.User.GetInfo(this.GetInfo_Handler.bind(this))},GetInfo_Handler:function(b){this.Info=b,a.$broadcast(e.UserInfoLoaded,b),this.InfoDeferred.resolve(b)},Info:{},GetLoginStatus:function(){f.User.GetInfo(this.GetLoginStatus_Handler.bind(this))},GetLoginStatus_Handler:function(b){b.error?(this.IsLoggedIn=!1,a.$broadcast(e.UserStatusChecked,this.IsLoggedIn)):(this.IsLoggedIn=!0,a.$broadcast(e.UserStatusChecked,this.IsLoggedIn))},IsLoggedIn:!1,Login:function(b,f){var g={email:b,password:f,rememberme:!1,redirect:"/alpha/"};c.post(d.Server+"/signin",g).success(function(b){b.result===1&&(console.log("Login()",this),a.$broadcast(e.UserLogin),this.IsLoggedIn=!0)}.bind(this)).error(function(b){a.$broadcast(e.UserLoginFailed,b),this.IsLoggedIn=!1}.bind(this))},Logout:function(){c.get(d.Server+"/signout").success(function(b){a.$broadcast(e.UserLogout),console.log("Logout():",this),this.IsLoggedIn=!1}.bind(this)).error(function(b){a.$broadcast(e.UserLogoutFailed)})}};return g}]),"use strict",yeomanApp.factory("UserStore",["$rootScope","$http","UIEvents","UserStoreUrl","Button","Guid",function(a,b,c,d,e,f){var g={Data:{Buttons:[]},GetData:function(a){b.get(d).success(function(b){b&&(this.Data=b),a&&a(b),console.log("GetData response",this.Data)}.bind(this))},SetData:function(a,c){b.put(d,a).success(function(a){c&&c(a)})},InitData:function(){this.Data={Buttons:[]}},Save:function(a){this.SetData(this.Data,a)},AddButtonConfig:function(a){var b={name:a.Options.name,color:a.Options.color,value1:a.Options.value1,value2:a.Options.value2,deviceGuid:a.GetDevice().GUID()};if(a.Options.hasOwnProperty("id")&&a.Options.id.length>0){b.id=a.Options.id;var c=this.GetButtonConfig(b.id),d=this.Data.Buttons.indexOf(c);this.Data.Buttons[d]=b,console.log("Button Config Updated:",b)}else b.id=f(),(!this.Data||!this.Data.Buttons)&&this.InitData(),console.log("DataStore:",this.Data,this.Data.Buttons),this.Data.Buttons.push(b)},GetButtonConfig:function(a){var b=null;for(var c=0;c<this.Data.Buttons.length;c++){var d=this.Data.Buttons[c];if(d.id===a){b=d;break}}return b},RemoveButton:function(b){var d=this.GetButtonConfig(b.Options.id),e=this.Data.Buttons.indexOf(d);this.Data.Buttons.splice(e,1),console.log("Removing Button",e,this.Data.Buttons),a.$broadcast(c.ButtonRemoved,b),this.Save()},GetButtons:function(a){var b=[],c=a?a:this.Data;if(c&&c.Buttons)for(var d=0;d<c.Buttons.length;d++){var f=c.Buttons[d],g=new e(f);b.push(g)}return b}};return a.$on(c.ButtonRemoving,function(a,b){g.RemoveButton(b)}),g}]),"use strict",yeomanApp.controller("ExistingDevicesCtrl",["$scope","$rootScope","UIEvents","NewButtonService","DeviceService",function(a,b,c,d,e){a.DeviceType=d.Type,a.ExistingDevices=[],a.CheckDeviceType=function(){a.DeviceType===""&&a.setRoute("/selectButton")},a.CheckDeviceType(),a.LoadDevices=function(){a.DeviceType&&(a.ExistingDevices=e.GetDeviceByType(a.DeviceType))},a.UseDevice=function(b){d.Button.SetDevice(b);switch(a.DeviceType){case"rf433":a.setRoute("/configureSocket");break;case"rgbled":a.setRoute("/configureLed");break;case"relay":a.setRoute("/configureRelay")}},a.$watch("DeviceType",function(){a.LoadDevices()})}]),"use strict",yeomanApp.factory("NewButtonService",["Button",function(a){var b={Type:"",Button:new a,Reset:function(){this.Button=new a,this.Type=""}};return b.Reset(),b}]),"use strict",yeomanApp.controller("ConfigureLedCtrl",["$scope","$rootScope","UIEvents","NewButtonService","UserStore",function(a,b,c,d,e){a.ButtonName=d.Button.Options.name,a.ButtonValue=d.Button.Options.value1,a.CheckDevice=function(){d.Button.GetDevice()===null&&a.setRoute("/selectButton")},a.CheckDevice(),a.SetColor=function(b){a.ButtonValue=b,d.Button.GetDevice().Options.value=b},a.Test=function(){d.Button.GetDevice().Emit(d.Button.GetDevice().Options.value)},a.Save=function(){d.Button.Options.name=a.ButtonName,d.Button.Options.value1=a.ButtonValue,e.AddButtonConfig(d.Button),e.Save(),a.setRoute("/")}}]),"use strict",yeomanApp.controller("ConfigureRelayCtrl",["$scope","$rootScope","UIEvents","NewButtonService","UserStore",function(a,b,c,d,e){a.ButtonName=d.Button.Options.name,a.CheckDevice=function(){d.Button.GetDevice()===null&&a.setRoute("/selectButton")},a.CheckDevice(),a.Save=function(){d.Button.Options.name=a.ButtonName,d.Button.Options.value1="1",d.Button.Options.value2="0",e.AddButtonConfig(d.Button),e.Save(),a.setRoute("/")}}]),"use strict",yeomanApp.controller("ConfigureSocketCtrl",["$scope","$rootScope","UIEvents","DeviceService","NewButtonService","UserStore",function(a,b,c,d,e,f){a.ButtonName=e.Button.Options.name,a.ButtonDevice=e.Button.GetDevice(),a.ButtonValue1=e.Button.Options.value1,a.ButtonValue2=e.Button.Options.value2,a.IsListening=!1,a.ListenEntries=[],a.ListenTarget=null,b.$on(c.PusherData,function(b,c){a.$apply(function(){if(a.IsListening&&a.ButtonDevice&&c.GUID===a.ButtonDevice.GUID()){var b=a.FindEntry(c.DA);if(b){var d=a.ListenEntries.indexOf(b);a.ListenEntries[d].Count++;var e=a.GetDetectedValueFromEntries();e&&(a[a.ListenTarget]=e.DA,a.Stop())}else{var f={DA:c.DA,Count:1};a.ListenEntries.push(f)}}})}),a.FindEntry=function(b){for(var c=0;c<a.ListenEntries.length;c++){var d=a.ListenEntries[c];if(d.DA===b)return d}},a.RemoveEntry=function(b){var c=a.ListenEntries.indexOf(b);a.ListenEntries.splice(c,1)},a.RemoveEntryByDataString=function(b){for(var c=0;c<a.ListenEntries.length;c++){var d=a.ListenEntries[c];if(d.DA===b){a.RemoveEntry(d);break}}},a.GetDetectedValueFromEntries=function(){for(var b=0;b<a.ListenEntries.length;b++){var c=a.ListenEntries[b];if(c.Count>=3)return c}},a.ButtonIsListening=function(b){return a[b]&&a.IsListening?!0:a.IsListening&&a.ListenTarget===b},a.Listen=function(b){a.ListenTarget=b,a.IsListening=!0},a.Stop=function(){a.IsListening=!1,a.ListenEntries=[],a.ListenTarget=null},a.Clear=function(b){a[b]=null},a.Save=function(){e.Button.Options.name=a.ButtonName,e.Button.Options.value1=a.ButtonValue1,e.Button.Options.value2=a.ButtonValue2,f.AddButtonConfig(e.Button),f.Save(),a.setRoute("/")}}]);